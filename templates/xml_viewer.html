<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XML Viewer - Nokia WebEM Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        body {
            min-height: 100vh;
            background: var(--primary-gradient);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .gradient-border {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box, var(--primary-gradient) border-box;
        }

        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            box-shadow: 0 4px 15px 0 rgba(102, 126, 234, 0.35);
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(102, 126, 234, 0.5);
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        /* Navigation styling for all screen sizes */
        .navbar {
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1) !important;
            z-index: 9999 !important;
            display: block !important;
            visibility: visible !important;
            position: relative !important;
            width: 100% !important;
            min-height: 60px !important;
        }

        .navbar-brand {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .nav-link {
            font-weight: 500;
            font-size: 1rem;
            padding: 0.5rem 0.75rem !important;
            margin: 0 0.25rem;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            transform: translateY(-1px);
        }

        /* Ensure navbar is visible on all desktop sizes */
        @media (min-width: 992px) {
            .navbar-nav {
                display: flex !important;
                visibility: visible !important;
                flex-direction: row !important;
                align-items: center !important;
            }
            
            .navbar-collapse {
                display: flex !important;
                flex-basis: auto;
                visibility: visible !important;
            }
            
            .nav-item {
                display: block !important;
                visibility: visible !important;
            }
            
            .nav-link {
                display: block !important;
                visibility: visible !important;
            }
        }

        /* Mobile navbar styling */
        @media (max-width: 991.98px) {
            .navbar-nav {
                background-color: rgba(102, 126, 234, 0.95) !important;
                border-radius: 0.5rem;
                padding: 1rem;
                margin-top: 1rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }
            
            .nav-link {
                margin: 0.25rem 0;
                color: rgba(255, 255, 255, 0.9) !important;
            }
            
            .nav-link:hover {
                background-color: rgba(255, 255, 255, 0.1) !important;
                color: white !important;
            }
        }

        /* Upload area styling */
        .upload-area {
            border: 2px dashed #c3cef7;
            background-color: #f8f9ff;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .upload-area:hover {
            border-color: #667eea;
            background-color: #f0f2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .dragover {
            border-color: #667eea !important;
            background-color: rgba(102, 126, 234, 0.1) !important;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3) !important;
        }

        /* Info cards styling */
        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px 0 rgba(31, 38, 135, 0.1);
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(31, 38, 135, 0.15);
        }

        /* Table styling */
        .table {
            --bs-table-bg: rgba(255, 255, 255, 0.9);
        }

        .table thead th {
            background: #667eea !important;
            color: white;
            border: none;
            font-weight: 600;
        }

        .table tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }

        /* Filter controls */
        .filter-controls {
            background: rgba(248, 249, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(102, 126, 234, 0.15);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        /* Badge styling */
        .badge {
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Tab styling */
        .nav-tabs {
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        }

        .nav-tabs .nav-link {
            border: none;
            color: #667eea;
            font-weight: 500;
            padding: 0.75rem 1.25rem;
            margin-right: 0.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            background-color: rgba(102, 126, 234, 0.1);
            color: #667eea !important;
        }

        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white !important;
            border: none;
        }

        /* Fix for nav-tabs hover conflicts */
        .nav-tabs .nav-link:not(.active):hover {
            background-color: rgba(102, 126, 234, 0.1) !important;
            color: #667eea !important;
            border: none !important;
        }

        /* Specific fix for XML viewer tabs */
        #cellsTab .nav-link:not(.active):hover,
        #cellRadioTab .nav-link:not(.active):hover {
            background-color: rgba(102, 126, 234, 0.1) !important;
            color: #667eea !important;
            border: none !important;
        }

        /* XML tree styling */
        .xml-tree { 
            font-family: 'Cascadia Code', 'Consolas', 'Monaco', 'Courier New', monospace; 
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .xml-tag { color: #667eea; font-weight: 600; }
        .xml-attr { color: #764ba2; }
        .xml-text { color: #333; }
        .collapsible { cursor: pointer; user-select: none; }
        .content { display: none; margin-left: 20px; }
        .collapsible::before {
            content: '\25B6'; /* ▶ */
            display: inline-block;
            margin-right: 6px;
            transition: transform 0.2s;
            color: #667eea;
        }
        .collapsible.active::before {
            content: '\25BC'; /* ▼ */
            transform: rotate(0deg);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container-fluid {
                padding: 1rem;
            }
            
            .glass-card {
                padding: 1.5rem !important;
            }
            
            .upload-area {
                padding: 1.5rem 1rem;
            }
            
            .table-responsive {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg" style="background: rgba(102, 126, 234, 0.9) !important; backdrop-filter: blur(15px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); padding: 0.75rem 0; display: block !important; visibility: visible !important; position: relative !important; z-index: 9999 !important; width: 100% !important; min-height: 60px !important;">
        <div class="container-fluid" style="display: flex !important; visibility: visible !important;">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="/" style="color: white;">
                <i class="bi bi-cpu me-2" style="font-size: 1.5rem;"></i>
                Nokia WebEM
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    style="box-shadow: none; outline: none;">
                <span class="navbar-toggler-icon" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTYgOUgyNEg2WiIgZmlsbD0iI2ZmZmZmZiIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTYgMTVIMjRINloiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxwYXRoIGQ9Ik02IDIxSDI0SDZaIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4K');"></span>
            </button>
            <div class="navbar-collapse show" id="navbarNav" style="display: flex !important; visibility: visible !important;">
                <ul class="navbar-nav ms-auto" style="display: flex !important; visibility: visible !important; flex-direction: row !important; align-items: center !important;">
                    <li class="nav-item" style="display: block !important; visibility: visible !important;">
                        <a class="nav-link px-3 py-2" href="/" style="color: rgba(255, 255, 255, 0.8) !important; font-weight: 500; display: block !important; visibility: visible !important; transition: all 0.3s ease;">
                            <i class="bi bi-house me-1"></i>მთავარი
                        </a>
                    </li>
                    <li class="nav-item" style="display: block !important; visibility: visible !important;">
                        <a class="nav-link px-3 py-2" href="/modernization" style="color: rgba(255, 255, 255, 0.8) !important; font-weight: 500; display: block !important; visibility: visible !important; transition: all 0.3s ease;">
                            <i class="bi bi-arrow-repeat me-1"></i>5G Modernization
                        </a>
                    </li>
                    <li class="nav-item" style="display: block !important; visibility: visible !important;">
                        <a class="nav-link px-3 py-2" href="/rollout" style="color: rgba(255, 255, 255, 0.8) !important; font-weight: 500; display: block !important; visibility: visible !important; transition: all 0.3s ease;">
                            <i class="bi bi-plus-circle me-1"></i>ახალი სადგური
                        </a>
                    </li>
                    <li class="nav-item" style="display: block !important; visibility: visible !important;">
                        <a class="nav-link px-3 py-2 rounded-2 mx-1" href="/xml-viewer" style="background: rgba(255, 255, 255, 0.2) !important; color: white !important; font-weight: 600; display: block !important; visibility: visible !important; border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);">
                            <i class="bi bi-file-earmark-code me-1"></i>XML Viewer
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-11 col-xl-10">
                <div class="glass-card rounded-4 p-4 p-md-5">
                    <!-- Header -->
                    <div class="text-center mb-5">
                        <div class="mb-4">
                            <i class="bi bi-file-earmark-code display-3 text-primary mb-3" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                        </div>
                        <h1 class="h1 fw-bold mb-2" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">XML Viewer</h1>
                        <p class="text-muted fs-5 mb-0">XML კონფიგურაციის სწრაფი და ვიზუალური ანალიზი</p>
                        <hr class="my-4 mx-auto" style="width: 100px; height: 3px; background: var(--primary-gradient); border: none; border-radius: 2px;">
                    </div>

                    <!-- File Upload Section -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <form id="multi-upload-form" enctype="multipart/form-data">
                                <!-- Upload Area -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <label class="form-label fw-semibold">
                                            <i class="bi bi-cloud-upload me-2 text-primary"></i>XML ფაილების ატვირთვა
                                        </label>
                                        <div class="upload-area rounded-3" id="xmlUploadArea">
                                            <i class="bi bi-cloud-upload text-muted mb-2" style="font-size: 2rem;"></i>
                                            <p class="mb-2">ატვირთეთ ერთი ან მეტი XML ფაილი</p>
                                            <input type="file" class="d-none" id="xml_files" name="xmlFiles" accept=".xml" multiple>
                                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="document.getElementById('xml_files').click()">
                                                <i class="bi bi-plus-circle me-1"></i>არჩევა
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- File Selection -->
                                <div class="row mb-4">
                                    <div class="col-12">
                                        <label class="form-label fw-semibold">
                                            <i class="bi bi-files me-2 text-success"></i>ატვირთული ფაილები
                                        </label>
                                        <div class="input-group">
                                            <select class="form-select" id="file-select">
                                                <option value="">ფაილები იტვირთება...</option>
                                            </select>
                                            <button class="btn btn-outline-danger" id="delete-file-btn" type="button" title="ფაილის წაშლა">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Info Blocks Container -->
                    <div id="info-blocks"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Navigation Enhancement Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fix mobile navigation collapse issue
        const navbarToggler = document.querySelector('.navbar-toggler');
        const navbarCollapse = document.querySelector('.navbar-collapse');
        
        // Close navbar on link click (mobile)
        document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth < 992) { // Only on mobile
                    const collapse = new bootstrap.Collapse(navbarCollapse, {
                        toggle: false
                    });
                    collapse.hide();
                }
            });
        });
    });
    </script>

    <script>
        // Helper: fetch and update file list
        async function updateFileList(selected) {
            const resp = await fetch('/api/list-xmls');
            const data = await resp.json();
            const select = document.getElementById('file-select');
            select.innerHTML = '';
            (data.files || []).forEach(f => {
                const opt = document.createElement('option');
                opt.value = f;
                opt.textContent = f;
                select.appendChild(opt);
            });
            if (selected && data.files.includes(selected)) {
                select.value = selected;
            }
            // If there are files, trigger change to load info
            if (select.value) {
                select.dispatchEvent(new Event('change'));
            } else {
                document.getElementById('info-blocks').innerHTML = '';
            }
        }
        // Upload handler
        document.getElementById('xml_files').addEventListener('change', async function() {
            const files = this.files;
            if (!files.length) return;
            await uploadFiles(files);
            this.value = '';
        });

        // Drag and drop functionality
        const uploadArea = document.getElementById('xmlUploadArea');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
        });

        // Handle dropped files
        uploadArea.addEventListener('drop', async function(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                await uploadFiles(files);
            }
        });

        // Upload files function
        async function uploadFiles(files) {
            // Only allow .xml files
            for (let f of files) {
                if (!f.name.toLowerCase().endsWith('.xml')) {
                    alert('მხოლოდ .xml ფაილების ატვირთვა შეიძლება!');
                    return;
                }
            }

            // Update upload area to show loading
            const uploadText = uploadArea.querySelector('p');
            const originalText = uploadText.textContent;
            uploadText.innerHTML = '<i class="spinner-border spinner-border-sm me-2" role="status"></i>ფაილები ატვირთება...';

            try {
                const formData = new FormData();
                for (let f of files) formData.append('xmlFiles', f);
                await fetch('/api/upload-xmls', { method: 'POST', body: formData });
                await updateFileList(files[0].name);
                
                // Success message
                uploadText.innerHTML = '<i class="bi bi-check-circle text-success me-2"></i>ფაილები წარმატებით აიტვირთა!';
                setTimeout(() => {
                    uploadText.textContent = originalText;
                }, 3000);
            } catch (error) {
                uploadText.innerHTML = '<i class="bi bi-x-circle text-danger me-2"></i>ატვირთვისას შეცდომა მოხდა';
                setTimeout(() => {
                    uploadText.textContent = originalText;
                }, 3000);
            }
        }
        // File select handler
        document.getElementById('file-select').onchange = async function() {
            const filename = this.value;
            if (!filename) {
                document.getElementById('info-blocks').innerHTML = '';
                return;
            }
            const resp = await fetch('/api/view-xml/' + encodeURIComponent(filename));
            const data = await resp.json();
            if (data.success) {
                renderInfoBlocks(data.data);
            } else {
                alert('ფაილის ნახვა ვერ მოხერხდა: ' + (data.error || 'Unknown error'));
            }
        };
        // Delete handler
        document.getElementById('delete-file-btn').onclick = async function() {
            const select = document.getElementById('file-select');
            const filename = select.value;
            if (!filename) return;
            if (!confirm('დარწმუნებული ხარ, რომ გინდა წაშალო ფაილი?')) return;
            await fetch('/api/delete-xml/' + encodeURIComponent(filename), { method: 'DELETE' });
            await updateFileList();
        };
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateFileList();
        });
        
        // Collapsible logic
        function bindCollapsibles() {
            const toggles = document.getElementsByClassName('collapsible');
            for (let i = 0; i < toggles.length; i++) {
                toggles[i].onclick = function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    if (content && content.classList.contains('content')) {
                        content.style.display = content.style.display === 'block' ? 'none' : 'block';
                    }
                }
            }
        }
        // Render all info blocks
        function renderInfoBlocks(config_data) {
            let infoHtml = '';
            if (!config_data) {
                document.getElementById('info-blocks').innerHTML = '';
                return;
            }
            // 1. ძირითადი ინფორმაცია
            infoHtml += `<div class="info-card mt-4 mb-4 p-4 rounded-4">
            <h5 class="mb-3 fw-bold" style="color: #667eea;"><i class="bi bi-info-circle me-2"></i>ძირითადი ინფორმაცია</h5>
            <div class="row">
                <div class="col-md-6 mb-2">
                    <b>სადგურის ID:</b> ${config_data.stationInfo?.mrbtsId || '-'}<br>
                    <b>BTS Name:</b> ${config_data.stationInfo?.btsName || '-'}<br>
                    <b>ვერსია:</b> ${config_data.stationInfo?.version || '-'}<br>
                    <b>5G:</b> ${config_data.stationInfo?.has5G ? '✔️' : '❌'}
                    <b>4G:</b> ${config_data.stationInfo?.has4G ? '✔️' : '❌'}
                    <b>3G:</b> ${config_data.stationInfo?.has3G ? '✔️' : '❌'}
                    <b>2G:</b> ${config_data.stationInfo?.has2G ? '✔️' : '❌'}
                </div>
                <div class="col-md-6 mb-2">
                    <b>NRBTS ID:</b> ${config_data.stationInfo?.nrbtsId || '-'}<br>
                    <b>LNBTS ID:</b> ${config_data.stationInfo?.lnbtsId || '-'}<br>
                    <b>WNBTS ID:</b> ${config_data.stationInfo?.wnbtsId || '-'}<br>
                    <b>BCF ID:</b> ${config_data.stationInfo?.bcfId || '-'}<br>
                </div>
            </div>
            </div>`;
            // 2. სექტორები და ქერიერები
            infoHtml += `<div class="info-card mt-4 mb-4 p-4 rounded-4">
            <h5 class="mb-3 fw-bold" style="color: #667eea;"><i class="bi bi-diagram-3-fill me-2"></i>სექტორები და ქერიერები</h5>
            <b>ტექნოლოგიები:</b> ${(config_data.radioInfo?.technologies || []).join(', ')}<br>
            <b>სექტორების რაოდენობა:</b> ${config_data.radioInfo?.sectorCount || '-'}<br>
            ${(config_data.radioInfo?.sectorDetails && Object.keys(config_data.radioInfo.sectorDetails).length) ? renderSectorsTable(config_data.radioInfo.sectorDetails) : ''}
            </div>`;
            // 3. Cells (უჯრედები)
            infoHtml += renderCellsSection(config_data.radioInfo?.cells || {});
            // 3.1. Cell-Radio Mapping
            infoHtml += renderCellRadioMappingSection(config_data.cellRadioMapping || []);
            // 4. ქსელის ინფორმაცია
            infoHtml += `<div class="info-card mt-4 mb-4 p-4 rounded-4">
            <h5 class="mb-3 fw-bold" style="color: #667eea;"><i class="bi bi-diagram-2 me-2"></i>ქსელის ინფორმაცია (VLAN + IP)</h5>
            <div class="table-responsive">
            <table class="table table-bordered table-sm align-middle text-center mt-2">
                <thead class="table-light">
                    <tr>
                        <th>Label</th><th>VLAN ID</th><th>IP</th><th>Prefix</th>
                    </tr>
                </thead>
                <tbody>
                    ${(config_data.networkInfo?.vlan_ip_combined || []).map(row => `
                        <tr>
                            <td>${row.label ? `<span class='badge bg-primary'>${row.label}</span>` : '-'}</td>
                            <td>${row.vlanId || '-'}</td>
                            <td>${row.ip || '-'}</td>
                            <td>${row.prefix || '-'}</td>
                        </tr>`).join('')}
                </tbody>
            </table></div>
            </div>`;
            // 5. მეზობლები და კაბინეტები
            infoHtml += `<div class="info-card mt-4 mb-4 p-4 rounded-4">
            <h5 class="mb-3 fw-bold" style="color: #667eea;"><i class="bi bi-diagram-2-fill me-2"></i>მეზობლები და კაბინეტები</h5>
            <b>კაბინეტების რაოდენობა:</b> ${config_data.hardwareInfo?.cabinetCount || '-'}<br>
            <b>მეზობლები:</b> <b>LTE:</b> ${config_data.neighborInfo?.lteNeighborCount} | <b>NR:</b> ${config_data.neighborInfo?.nrNeighborCount} | <b>X2:</b> ${config_data.neighborInfo?.x2LinkCount}
            </div>`;
            document.getElementById('info-blocks').innerHTML = infoHtml;
            bindCollapsibles();
        }
        function renderSectorsTable(sectorDetails) {
            // Collect all unique sectors
            let all_sectors = [];
            Object.values(sectorDetails).forEach(sectors => {
                Object.keys(sectors).forEach(sector => {
                    if (!all_sectors.includes(sector)) all_sectors.push(sector);
                });
            });
            all_sectors = all_sectors.sort();
            let html = `<b>სექტორები და ქერიერები:</b><div class="table-responsive"><table class="table table-bordered table-sm align-middle text-center mt-2"><thead class="table-light"><tr><th>ტექნოლოგია</th>`;
            all_sectors.forEach(sector => { html += `<th>სექტორი ${sector}</th>`; });
            html += `</tr></thead><tbody>`;
            Object.entries(sectorDetails).forEach(([tech, sectors]) => {
                html += `<tr><td><b>${tech}</b></td>`;
                all_sectors.forEach(sector => {
                    html += `<td>${sectors[sector] !== undefined ? sectors[sector] : '-'}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table></div>`;
            return html;
        }
        function renderCellsSection(cells) {
            // Determine which technologies are present
            const techs = [
                { key: '2G', label: '2G (GSM)' },
                { key: '3G', label: '3G (WCDMA)' },
                { key: '4G', label: '4G (LTE)' },
                { key: '5G', label: '5G NR' }
            ];
            let html = `<div class="info-card mt-4 mb-4 p-4 rounded-4">
                <h5 class="mb-3 fw-bold" style="color: #667eea;"><i class="bi bi-diagram-3 me-2"></i>Cells</h5>
                <!-- Filter Controls -->
                <div class="filter-controls">
                <div class="row mb-3">
                    <div class="col-md-2">
                        <label class="form-label small">სელის სახელი:</label>
                        <input type="text" class="form-control form-control-sm" id="cells-name-filter" placeholder="სელის სახელი...">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">Cell ID:</label>
                        <select class="form-select form-select-sm" id="cells-cellid-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">სექტორი:</label>
                        <select class="form-select form-select-sm" id="cells-sector-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">ქერიერი:</label>
                        <select class="form-select form-select-sm" id="cells-carrier-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <label class="form-label small">PCI:</label>
                        <select class="form-select form-select-sm" id="cells-pci-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <label class="form-label small">TAC:</label>
                        <select class="form-select form-select-sm" id="cells-tac-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">Root Seq:</label>
                        <select class="form-select form-select-sm" id="cells-rootseq-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button class="btn btn-outline-secondary btn-sm me-2" onclick="clearCellsFilters()">
                            <i class="bi bi-x-circle"></i> გასუფთავება
                        </button>
                        <span class="text-muted small" id="cells-count"></span>
                    </div>
                </div>
                </div>
                <ul class="nav nav-tabs mb-3" id="cellsTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab-all" data-bs-toggle="tab" data-bs-target="#cells-all" type="button" role="tab">All</button>
                    </li>`;
            techs.forEach(t => {
                const disabled = !(cells[t.key] && cells[t.key].length > 0);
                html += `<li class="nav-item" role="presentation">
                    <button class="nav-link${disabled ? ' disabled' : ''}" id="tab-${t.key}" data-bs-toggle="tab" data-bs-target="#cells-${t.key}" type="button" role="tab">${t.label}</button>
                </li>`;
            });
            html += `</ul><div class="tab-content" id="cellsTabContent">`;
            // All tab: show all tables as before
            html += `<div class="tab-pane fade show active" id="cells-all" role="tabpanel">`;
            techs.forEach(t => {
                html += renderSingleCellsTable(t.key, cells);
            });
            html += `</div>`;
            // Per-tech tabs
            techs.forEach(t => {
                html += `<div class="tab-pane fade" id="cells-${t.key}" role="tabpanel">`;
                html += renderSingleCellsTable(t.key, cells);
                html += `</div>`;
            });
            html += `</div></div></div>`;
            // After rendering, activate Bootstrap tabs and filters
            setTimeout(() => {
                if (window.bootstrap && window.bootstrap.Tab) {
                    // Already loaded
                } else {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
                    document.body.appendChild(script);
                }
                // Initialize filters
                initializeCellsFilters(cells);
            }, 0);
            return html;
        }
        // Initialize cells filters
        function initializeCellsFilters(cells) {
            // Collect all unique values for each filter
            const allNames = new Set();
            const allCellIds = new Set();
            const allSectors = new Set();
            const allCarriers = new Set();
            const allPCIs = new Set();
            const allTACs = new Set();
            const allRootSeqs = new Set();
            Object.values(cells).forEach(techCells => {
                techCells.forEach(cell => {
                    if (cell.cellName) allNames.add(cell.cellName);
                    if (cell.cellId) allCellIds.add(cell.cellId);
                    if (cell.sector) allSectors.add(cell.sector);
                    if (cell.carrier) allCarriers.add(cell.carrier);
                    if (cell.phyCellId) allPCIs.add(cell.phyCellId);
                    if (cell.trackingAreaCode) allTACs.add(cell.trackingAreaCode);
                    if (cell.rachRootSequence) allRootSeqs.add(cell.rachRootSequence);
                });
            });
            // Populate dropdowns
            const cellIdFilter = document.getElementById('cells-cellid-filter');
            Array.from(allCellIds).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                cellIdFilter.appendChild(option);
            });
            const sectorFilter = document.getElementById('cells-sector-filter');
            Array.from(allSectors).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                sectorFilter.appendChild(option);
            });
            const carrierFilter = document.getElementById('cells-carrier-filter');
            Array.from(allCarriers).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                carrierFilter.appendChild(option);
            });
            const pciFilter = document.getElementById('cells-pci-filter');
            Array.from(allPCIs).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                pciFilter.appendChild(option);
            });
            const tacFilter = document.getElementById('cells-tac-filter');
            Array.from(allTACs).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                tacFilter.appendChild(option);
            });
            const rootSeqFilter = document.getElementById('cells-rootseq-filter');
            Array.from(allRootSeqs).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                rootSeqFilter.appendChild(option);
            });
            // Add event listeners
            document.getElementById('cells-name-filter').addEventListener('input', filterCells);
            document.getElementById('cells-cellid-filter').addEventListener('change', filterCells);
            document.getElementById('cells-sector-filter').addEventListener('change', filterCells);
            document.getElementById('cells-carrier-filter').addEventListener('change', filterCells);
            document.getElementById('cells-pci-filter').addEventListener('change', filterCells);
            document.getElementById('cells-tac-filter').addEventListener('change', filterCells);
            document.getElementById('cells-rootseq-filter').addEventListener('change', filterCells);
            // Initial count
            updateCellsCount();
        }
        // Filter cells function
        function filterCells() {
            const nameFilter = document.getElementById('cells-name-filter').value.toLowerCase();
            const cellIdFilter = document.getElementById('cells-cellid-filter').value;
            const sectorFilter = document.getElementById('cells-sector-filter').value;
            const carrierFilter = document.getElementById('cells-carrier-filter').value;
            const pciFilter = document.getElementById('cells-pci-filter').value;
            const tacFilter = document.getElementById('cells-tac-filter').value;
            const rootSeqFilter = document.getElementById('cells-rootseq-filter').value;
            const rows = document.querySelectorAll('#cellsTabContent tbody tr');
            let visibleCount = 0;
            rows.forEach(row => {
                const cellName = row.getAttribute('data-cellname') || '';
                const cellId = row.getAttribute('data-cellid') || '';
                const sector = row.getAttribute('data-sector') || '';
                const carrier = row.getAttribute('data-carrier') || '';
                const pci = row.getAttribute('data-pci') || '';
                const tac = row.getAttribute('data-tac') || '';
                const rootseq = row.getAttribute('data-rootseq') || '';
                let show = true;
                if (nameFilter && !cellName.toLowerCase().includes(nameFilter)) show = false;
                if (cellIdFilter && cellId !== cellIdFilter) show = false;
                if (sectorFilter && sector !== sectorFilter) show = false;
                if (carrierFilter && carrier !== carrierFilter) show = false;
                if (pciFilter && pci !== pciFilter) show = false;
                if (tacFilter && tac !== tacFilter) show = false;
                if (rootSeqFilter && rootseq !== rootSeqFilter) show = false;
                row.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });
            document.getElementById('cells-count').textContent = `ნაჩვენები: ${visibleCount}`;
        }
        // Clear cells filters
        function clearCellsFilters() {
            document.getElementById('cells-name-filter').value = '';
            document.getElementById('cells-cellid-filter').value = '';
            document.getElementById('cells-sector-filter').value = '';
            document.getElementById('cells-carrier-filter').value = '';
            document.getElementById('cells-pci-filter').value = '';
            document.getElementById('cells-tac-filter').value = '';
            document.getElementById('cells-rootseq-filter').value = '';
            filterCells();
        }
        // Update cells count
        function updateCellsCount() {
            const visibleRows = document.querySelectorAll('#cellsTabContent tbody tr:not([style*="display: none"])');
            document.getElementById('cells-count').textContent = `ნაჩვენები: ${visibleRows.length}`;
        }
        // Helper: render a single technology's cells table
        function renderSingleCellsTable(tech, cells) {
            if (tech === '2G') {
                if (cells['2G'] && cells['2G'].length > 0) {
                    let html = `<div class="table-responsive mt-2"><table class="table table-bordered table-sm align-middle text-center"><thead class="table-light"><tr><th>Cell Name</th><th>Cell ID</th><th>სექტორი</th><th>ქერიერი</th><th>BCCH</th><th>NCC</th><th>BCC</th><th>LAC</th><th>CI</th></tr></thead><tbody>`;
                    cells['2G'].forEach(cell => {
                        html += `<tr data-cellname="${cell.cellName || ''}" data-cellid="${cell.cellId || ''}" data-sector="${cell.sector || ''}" data-carrier="${cell.carrier || ''}" data-pci="" data-tac="" data-rootseq="">
                            <td>${cell.cellName || '-'}</td><td>${cell.cellId || '-'}</td><td>${cell.sector || '-'}</td><td>${cell.carrier || '-'}</td><td>${cell.bcch || '-'}</td><td>${cell.ncc || '-'}</td><td>${cell.bcc || '-'}</td><td>${cell.lac || '-'}</td><td>${cell.ci || '-'}</td></tr>`;
                    });
                    html += `</tbody></table></div>`;
                    return html;
                } else {
                    return `<div class="text-muted">No 2G cells found.</div>`;
                }
            }
            if (tech === '3G') {
                if (cells['3G'] && cells['3G'].length > 0) {
                    let html = `<div class="table-responsive mt-2"><table class="table table-bordered table-sm align-middle text-center"><thead class="table-light"><tr><th>Cell ID</th><th>სექტორი</th><th>ქერიერი</th><th>DL UARFCN</th><th>Cell Power</th></tr></thead><tbody>`;
                    cells['3G'].forEach(cell => {
                        html += `<tr data-cellname="" data-cellid="${cell.cellId || ''}" data-sector="${cell.sector || ''}" data-carrier="${cell.carrier || ''}" data-pci="" data-tac="" data-rootseq="">
                            <td>${cell.cellId || '-'}</td><td>${cell.sector || '-'}</td><td>${cell.carrier || '-'}</td><td>${cell.uarfcnDl || '-'}</td><td>${cell.maxTxPower || '-'}</td></tr>`;
                    });
                    html += `</tbody></table></div>`;
                    return html;
                } else {
                    return `<div class="text-muted">No 3G cells found.</div>`;
                }
            }
            if (tech === '4G') {
                if (cells['4G'] && cells['4G'].length > 0) {
                    let html = `<div class="table-responsive mt-2"><table class="table table-bordered table-sm align-middle text-center"><thead class="table-light"><tr><th>Cell Name</th><th>Cell ID</th><th>სექტორი</th><th>ქერიერი</th><th>Local Cell Resource ID</th><th>Physical layer Cell ID</th><th>Tracking area code</th><th>RACH root sequence</th><th>EARFCN_DL</th><th>EARFCN_UL</th><th>MIMO Mode</th><th>Bandwidth</th></tr></thead><tbody>`;
                    cells['4G'].forEach(cell => {
                        html += `<tr data-cellname="${cell.cellName || ''}" data-cellid="${cell.cellId || ''}" data-sector="${cell.sector || ''}" data-carrier="${cell.carrier || ''}" data-pci="${cell.phyCellId || ''}" data-tac="${cell.trackingAreaCode || ''}" data-rootseq="${cell.rachRootSequence || ''}">
                            <td>${cell.cellName || '-'}</td><td>${cell.cellId || '-'}</td><td>${cell.sector || '-'}</td><td>${cell.carrier || '-'}</td><td>${cell.localCellId || '-'}</td><td>${cell.phyCellId || '-'}</td><td>${cell.trackingAreaCode || '-'}</td><td>${cell.rachRootSequence || '-'}</td><td>${cell.earfcnDL || '-'}</td><td>${cell.earfcnUL || '-'}</td><td>${cell.mimoMode || '-'}</td><td>${cell.bandwidth || '-'}</td></tr>`;
                    });
                    html += `</tbody></table></div>`;
                    return html;
                } else {
                    return `<div class="text-muted">No 4G cells found.</div>`;
                }
            }
            if (tech === '5G') {
                if (cells['5G'] && cells['5G'].length > 0) {
                    let html = `<div class="table-responsive mt-2"><table class="table table-bordered table-sm align-middle text-center"><thead class="table-light"><tr><th>Cell Name</th><th>Cell ID</th><th>სექტორი</th><th>ქერიერი</th><th>Local Cell Resource ID</th><th>Physical layer Cell ID</th><th>Cell Technology</th><th>Cell Working Type</th><th>Frequency Band</th><th>NRARFCN</th><th>Bandwidth</th><th>Cell Power</th></tr></thead><tbody>`;
                    cells['5G'].forEach(cell => {
                        // Handle FDD vs TDD display
                        let nrarfcn = '-';
                        let bandwidth = '-';
                        if (cell.cellTechnology === 'TDD') {
                            // TDD: show combined values
                            nrarfcn = cell.nrarfcnDL || '-';
                            bandwidth = cell.bandwidthDL || '-';
                        } else {
                            // FDD: show DL/UL format
                            nrarfcn = `${cell.nrarfcnDL || '-'}/${cell.nrarfcnUL || '-'}`;
                            bandwidth = `${cell.bandwidthDL || '-'}/${cell.bandwidthUL || '-'}`;
                        }
                        html += `<tr data-cellname="${cell.cellName || ''}" data-cellid="${cell.cellId || ''}" data-sector="${cell.sector || ''}" data-carrier="${cell.carrier || ''}" data-pci="${cell.phyCellId || ''}" data-tac="${cell.trackingAreaCode || ''}" data-rootseq="${cell.rachRootSequence || ''}">
                            <td>${cell.cellName || '-'}</td><td>${cell.cellId || '-'}</td><td>${cell.sector || '-'}</td><td>${cell.carrier || '-'}</td><td>${cell.localCellId || '-'}</td><td>${cell.phyCellId || '-'}</td><td>${cell.cellTechnology || '-'}</td><td>${cell.cellWorkingType || '-'}</td><td>${cell.frequencyBand || '-'}</td><td>${nrarfcn}</td><td>${bandwidth}</td><td>${cell.cellPower || '-'}</td></tr>`;
                    });
                    html += `</tbody></table></div>`;
                    return html;
                } else {
                    return `<div class="text-muted">No 5G cells found.</div>`;
                }
            }
            return '';
        }
        function renderCellRadioMappingSection(mapping) {
            if (!mapping || mapping.length === 0) return '';
            let html = `<div class="info-card mt-4 mb-4 p-4 rounded-4">
                <h5 class="mb-3 fw-bold" style="color: #667eea;"><i class="bi bi-hdd-network me-2"></i>სელების რადიო მოდულებზე მიბმა</h5>
                <!-- Filter Controls -->
                <div class="filter-controls">
                <div class="row mb-3">
                    <div class="col-md-2">
                        <label class="form-label small">Cell ID:</label>
                        <select class="form-select form-select-sm" id="radio-cellid-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">ქერიერი:</label>
                        <select class="form-select form-select-sm" id="radio-carrier-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">სექტორი:</label>
                        <select class="form-select form-select-sm" id="radio-sector-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">რადიო მოდული:</label>
                        <select class="form-select form-select-sm" id="radio-module-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <label class="form-label small">პორტი:</label>
                        <select class="form-select form-select-sm" id="radio-port-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-1">
                        <label class="form-label small">რეჟიმი:</label>
                        <select class="form-select form-select-sm" id="radio-mode-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">მოდელი:</label>
                        <select class="form-select form-select-sm" id="radio-model-filter">
                            <option value="">ყველა</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button class="btn btn-outline-secondary btn-sm me-2" onclick="clearRadioFilters()">
                            <i class="bi bi-x-circle"></i> გასუფთავება
                        </button>
                        <span class="text-muted small" id="radio-count"></span>
                    </div>
                </div>
                </div>
                <ul class="nav nav-tabs mb-3" id="cellRadioTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab-radio-ALL" data-bs-toggle="tab" data-bs-target="#cell-radio-ALL" type="button" role="tab">All</button>
                    </li>`;
            const techs = [
                { key: '2G', label: '2G (GSM)' },
                { key: '3G', label: '3G (WCDMA)' },
                { key: '4G', label: '4G (LTE)' },
                { key: '5G', label: '5G NR' }
            ];
            techs.forEach(t => {
                html += `<li class="nav-item" role="presentation">
                    <button class="nav-link" id="tab-radio-${t.key}" data-bs-toggle="tab" data-bs-target="#cell-radio-${t.key}" type="button" role="tab">${t.label}</button>
                </li>`;
            });
            html += `</ul><div class="tab-content" id="cellRadioTabContent">`;
            // ALL tab
            html += `<div class="tab-pane fade show active" id="cell-radio-ALL" role="tabpanel">`;
            html += renderCellRadioMappingTable(mapping);
            html += `</div>`;
            // Per-tech tabs
            techs.forEach(t => {
                html += `<div class="tab-pane fade" id="cell-radio-${t.key}" role="tabpanel">`;
                html += renderCellRadioMappingTable(mapping.filter(row => row.tech === t.key));
                html += `</div>`;
            });
            html += `</div></div>`;
            // Bootstrap tabs activation and filter initialization
            setTimeout(() => {
                if (window.bootstrap && window.bootstrap.Tab) {
                    // Already loaded
                } else {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
                    document.body.appendChild(script);
                }
                // Initialize radio mapping filters
                initializeRadioFilters(mapping);
            }, 0);
            return html;
        }
        // Initialize radio mapping filters
        function initializeRadioFilters(mapping) {
            // Collect all unique values for each filter
            const allCellIds = new Set();
            const allCarriers = new Set();
            const allSectors = new Set();
            const allModules = new Set();
            const allPorts = new Set();
            const allModes = new Set();
            const allModels = new Set();
            mapping.forEach(row => {
                if (row.cell) allCellIds.add(row.cell);
                if (row.carrier) allCarriers.add(row.carrier);
                if (row.sector) allSectors.add(row.sector);
                if (row.radio_module) allModules.add(row.radio_module);
                if (row.port) allPorts.add(row.port);
                if (row.mode) allModes.add(row.mode);
                if (row.model) allModels.add(row.model);
            });
            // Populate dropdowns
            const cellIdFilter = document.getElementById('radio-cellid-filter');
            Array.from(allCellIds).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                cellIdFilter.appendChild(option);
            });
            const carrierFilter = document.getElementById('radio-carrier-filter');
            Array.from(allCarriers).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                carrierFilter.appendChild(option);
            });
            const sectorFilter = document.getElementById('radio-sector-filter');
            Array.from(allSectors).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                sectorFilter.appendChild(option);
            });
            const moduleFilter = document.getElementById('radio-module-filter');
            Array.from(allModules).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                moduleFilter.appendChild(option);
            });
            const portFilter = document.getElementById('radio-port-filter');
            Array.from(allPorts).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                portFilter.appendChild(option);
            });
            const modeFilter = document.getElementById('radio-mode-filter');
            Array.from(allModes).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                modeFilter.appendChild(option);
            });
            const modelFilter = document.getElementById('radio-model-filter');
            Array.from(allModels).sort().forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                modelFilter.appendChild(option);
            });
            // Add event listeners
            document.getElementById('radio-cellid-filter').addEventListener('change', filterRadioMapping);
            document.getElementById('radio-carrier-filter').addEventListener('change', filterRadioMapping);
            document.getElementById('radio-sector-filter').addEventListener('change', filterRadioMapping);
            document.getElementById('radio-module-filter').addEventListener('change', filterRadioMapping);
            document.getElementById('radio-port-filter').addEventListener('change', filterRadioMapping);
            document.getElementById('radio-mode-filter').addEventListener('change', filterRadioMapping);
            document.getElementById('radio-model-filter').addEventListener('change', filterRadioMapping);
            // Initial count
            updateRadioCount();
        }
        // Filter radio mapping function
        function filterRadioMapping() {
            const cellIdFilter = document.getElementById('radio-cellid-filter').value;
            const carrierFilter = document.getElementById('radio-carrier-filter').value;
            const sectorFilter = document.getElementById('radio-sector-filter').value;
            const moduleFilter = document.getElementById('radio-module-filter').value;
            const portFilter = document.getElementById('radio-port-filter').value;
            const modeFilter = document.getElementById('radio-mode-filter').value;
            const modelFilter = document.getElementById('radio-model-filter').value;
            const rows = document.querySelectorAll('#cellRadioTabContent tbody tr');
            let visibleCount = 0;
            rows.forEach(row => {
                const cellId = row.getAttribute('data-cellid');
                const carrier = row.getAttribute('data-carrier');
                const sector = row.getAttribute('data-sector');
                const module = row.getAttribute('data-module');
                const port = row.getAttribute('data-port');
                const mode = row.getAttribute('data-mode');
                const model = row.getAttribute('data-model');
                let show = true;
                if (cellIdFilter && cellId !== cellIdFilter) show = false;
                if (carrierFilter && carrier !== carrierFilter) show = false;
                if (sectorFilter && sector !== sectorFilter) show = false;
                if (moduleFilter && module !== moduleFilter) show = false;
                if (portFilter && port !== portFilter) show = false;
                if (modeFilter && mode !== modeFilter) show = false;
                if (modelFilter && model !== modelFilter) show = false;
                row.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });
            document.getElementById('radio-count').textContent = `ნაჩვენები: ${visibleCount}`;
        }
        // Clear radio mapping filters
        function clearRadioFilters() {
            document.getElementById('radio-cellid-filter').value = '';
            document.getElementById('radio-carrier-filter').value = '';
            document.getElementById('radio-sector-filter').value = '';
            document.getElementById('radio-module-filter').value = '';
            document.getElementById('radio-port-filter').value = '';
            document.getElementById('radio-mode-filter').value = '';
            document.getElementById('radio-model-filter').value = '';
            filterRadioMapping();
        }
        // Update radio mapping count
        function updateRadioCount() {
            const visibleRows = document.querySelectorAll('#cellRadioTabContent tbody tr:not([style*="display: none"])');
            document.getElementById('radio-count').textContent = `ნაჩვენები: ${visibleRows.length}`;
        }
        function renderCellRadioMappingTable(rows) {
            if (!rows || rows.length === 0) {
                return `<div class="text-muted">No data found.</div>`;
            }
            let html = `<div class="table-responsive"><table class="table table-bordered table-sm align-middle text-center mt-2">
                <thead class="table-light">
                    <tr>
                        <th>Cell</th><th>Tech</th><th>Carrier</th><th>Sector</th><th>Radio module</th><th>Port</th><th>Mode</th><th>Model</th>
                    </tr>
                </thead>
                <tbody>`;
            rows.forEach(row => {
                html += `<tr data-cellid="${row.cell || ''}" data-carrier="${row.carrier || ''}" data-sector="${row.sector || ''}" data-module="${row.radio_module || ''}" data-port="${row.port || ''}" data-mode="${row.mode || ''}" data-model="${row.model || ''}">
                    <td>${row.cell || '-'}</td>
                    <td>${row.tech || '-'}</td>
                    <td>${row.carrier || '-'}</td>
                    <td>${row.sector || '-'}</td>
                    <td>${row.radio_module || '-'}</td>
                    <td>${row.port || '-'}</td>
                    <td>${row.mode || '-'}</td>
                    <td>${row.model || '-'}</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
            return html;
        }
        </script>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Navigation Enhancement Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fix mobile navigation collapse issue
    const navbarToggler = document.querySelector('.navbar-toggler');
    const navbarCollapse = document.querySelector('.navbar-collapse');
    
    // Close navbar on link click (mobile)
    document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth < 992) { // Only on mobile
                const collapse = new bootstrap.Collapse(navbarCollapse, {
                    toggle: false
                });
                collapse.hide();
            }
        });
    });
});
</script>
</body>
</html> 